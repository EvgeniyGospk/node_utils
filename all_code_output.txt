--- File: aicon.js ---

#!/usr/bin/env node

import fs from "fs/promises";
import path from "path";
import yargs from "yargs";
import { hideBin } from "yargs/helpers";

// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---

// !!! –í–ê–ñ–ù–û: –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç !!!
// –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø—É—Ç–∏ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
const ESSENTIAL_FILES = [
  "package.json",
  "nx.json", // –∏–ª–∏ turbo.json, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Turborepo
  "tsconfig.base.json", // –∏–ª–∏ –∫–æ—Ä–Ω–µ–≤–æ–π tsconfig.json
  "apps/backend/tsconfig.app.json", // –ü—Ä–∏–º–µ—Ä
  "apps/frontend/tsconfig.json", // –ü—Ä–∏–º–µ—Ä
  "apps/frontend/vite.config.ts", // –ü—Ä–∏–º–µ—Ä
  "nest-cli.json", // –ü—Ä–∏–º–µ—Ä –¥–ª—è NestJS
  ".eslintrc.js", // –∏–ª–∏ .json, .yaml ...
  ".prettierrc.js", // –∏–ª–∏ .json, .yaml ...
  "Dockerfile", // –ï—Å–ª–∏ –µ—Å—Ç—å –≥–ª–∞–≤–Ω—ã–π
  "docker-compose.yml", // –ï—Å–ª–∏ –µ—Å—Ç—å
  // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –í–ê–ñ–ù–´–ï –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ñ–∞–π–ª—ã!
];

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
const DIRTREE_EXCLUDE_DIRS = ["node_modules", ".git", "dist", "build"]; // –ü–∞–ø–∫–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
const DIRTREE_MAX_DEPTH = 3; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞

// –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const DEFAULT_OUTPUT_FILENAME = "ai_session_context.md";

// --- –®–ê–ë–õ–û–ù –ü–†–û–ú–ü–¢–ê –î–õ–Ø –ù–û–í–û–ô –°–ï–°–°–ò–ò ---
// (–í–∑—è—Ç –Ω–∞—à —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
const NEW_SESSION_PROMPT_TEMPLATE = `
# –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ü—Ä–æ–µ–∫—Ç: –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°–µ—Å—Å–∏–∏ –∏ –ó–∞–ø—Ä–æ—Å –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ v2 (–ü—Ä–æ–º–ø—Ç –¥–ª—è AI)

**(–í–∞–∂–Ω–æ: –≠—Ç–æ –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –ù–û–í–û–ô —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –ø–æ–ª–Ω—É—é –ø–æ—Ç–µ—Ä—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ AI)**

---

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI –Ω–∞ –≠—Ç—É –°–µ—Å—Å–∏—é:**

–ü—Ä–∏–≤–µ—Ç! –ú—ã –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –Ω–∞—à–∏–º **—ç—Ç–∞–ª–æ–Ω–Ω—ã–º full-stack –ø—Ä–æ–µ–∫—Ç–æ–º**.

**–¢–≤–æ—è –†–æ–ª—å –≤ –≠—Ç–æ–π –°–µ—Å—Å–∏–∏:** –¢—ã ‚Äî **–≥–ª–∞–≤–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –≤–µ–¥—É—â–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ü–û –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫** —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –Ø ‚Äî —Ç–≤–æ–π –∑–∞–∫–∞–∑—á–∏–∫ –∏ –º–ª–∞–¥—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≤–µ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É, –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Å–ª–µ–¥—É—è –≤—ã—Å–æ—á–∞–π—à–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.

**–ù–∞—à–∞ –¶–µ–ª—å ("–ê–±—Å–æ–ª—é—Ç–Ω—ã–π –≠—Ç–∞–ª–æ–Ω"):** –ú—ã —Å–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–∑—Ü–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React/Node.js), —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—è—Å—å: SOLID, DDD, –ß–∏—Å—Ç–æ–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã/–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π, FSD (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥), —Å—Ç—Ä–æ–≥–∏–π TypeScript, –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (NestJS, Prisma, GraphQL –∏ —Ç.–¥.), –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, DevOps, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (ADRs!). –¢—ã –¥–æ–ª–∂–µ–Ω —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è —ç—Ç–∏–º–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ –≤–æ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö.

**–ù–∞—à –ú–µ—Ç–æ–¥ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤ –≠—Ç–æ–π –°–µ—Å—Å–∏–∏:**
*   **–¢—ã –í–µ–¥–µ—à—å, –Ø –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é:** –¢—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å —à–∞–≥–∏, —Ä–µ—à–µ–Ω–∏—è, –∫–æ–¥, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –Ø –∑–∞–¥–∞—é –≤–æ–ø—Ä–æ—Å—ã –∏ –¥–∞—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (\`–û–ö\`, \`–°–û–ì–õ–ê–°–ï–ù\`, \`–î–ï–õ–ê–ï–ú\`) –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∏—à—å –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å —á—Ç–æ-—Ç–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ.
*   **–ü–æ—à–∞–≥–æ–≤–æ—Å—Ç—å –∏ –§–æ–∫—É—Å:** –î–≤–∏–≥–∞–µ–º—Å—è **–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º–∏ —ç—Ç–∞–ø–∞–º–∏**. –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –∑–∞ —Ä–∞–∑. –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π –º–µ–Ω—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
*   **–ê–∫—Ç–∏–≤–Ω—ã–µ –í–æ–ø—Ä–æ—Å—ã –æ—Ç –¢–µ–±—è:** –¢—ã *–æ–±—è–∑–∞–Ω* –∞–∫—Ç–∏–≤–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –º–Ω–µ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã *–ø–µ—Ä–µ–¥* –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞/–∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏–π. –ü—Ä–µ–¥–ª–∞–≥–∞–π –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –ø–ª—é—Å–∞–º–∏/–º–∏–Ω—É—Å–∞–º–∏ –∏ –∂–¥–∏ –º–æ–µ–≥–æ –≤—ã–±–æ—Ä–∞. **–ù–µ –¥–µ–ª–∞–π –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –±–µ–∑ —è–≤–Ω–æ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è!**
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–µ–º–ø–æ–º:** –Ø –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã \`–ì–û–¢–û–í\`, \`–ü–û–î–†–û–ë–ù–ï–ï\`, \`–ú–ï–î–õ–ï–ù–ù–ï–ï\` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–ø–æ–º.
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ—Å—Å–∏—è–º–∏:** –Ø –∏—Å–ø–æ–ª—å–∑—É—é \`–ü–ê–£–ó–ê –°–ï–°–°–ò–ò\` (–ø–æ—Å–ª–µ —Ç–≤–æ–µ–≥–æ –†–µ–∑—é–º–µ) –∏ \`–í–û–ó–û–ë–ù–û–í–ò–¢–¨ –°–ï–°–°–ò–Æ\` (—Å —Ç–≤–æ–∏–º –†–µ–∑—é–º–µ + –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º).
*   **Git –∏ ADRs:** –¢—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∫–æ–º–º–∏—Ç—ã (Conventional Commits) –∏ —Ñ–∏–∫—Å–∞—Ü–∏—é —Ä–µ—à–µ–Ω–∏–π –≤ ADR.
*   **–ü–æ–º–æ—â—å –ø—Ä–∏ –û—à–∏–±–∫–∞—Ö:** –ï—Å–ª–∏ —è —Å–æ–æ–±—â—É –æ–± –æ—à–∏–±–∫–µ, —Ç—ã –ø–æ–º–æ–∂–µ—à—å –µ–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.
*   **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:** –¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å markdown/ASCII –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

**–ù–∞—à–∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ (\`dirtree\`, \`codescan\`):**
*   –Ø (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã \`dirtree\` –∏ \`codescan\` –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–µ–±–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –∫–æ–¥–µ –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ–≥–¥–∞ —Ç—ã –µ–µ –∑–∞–ø—Ä–æ—Å–∏—à—å –∏–ª–∏ –∫–æ–≥–¥–∞ —è –ø–æ—Å—á–∏—Ç–∞—é –Ω—É–∂–Ω—ã–º.
*   **–¢—ã –º–æ–∂–µ—à—å (–∏ –¥–æ–ª–∂–µ–Ω!) –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å** —É –º–µ–Ω—è –≤—ã–≤–æ–¥ —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥ —Å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏**, –∫–æ–≥–¥–∞ —Ç–µ–±–µ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
*   **\`dirtree\`:** –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—à—å \`dirtree --dir [–ø—É—Ç—å] --md [–≥–ª—É–±–∏–Ω–∞] ...\`. –Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –≤—ã–≤–æ–¥ –≤ \`\`\`text –±–ª–æ–∫–µ.
*   **\`codescan\`:** –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ —Ç—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—à—å \`codescan -of [–ò–º—è–§–∞–π–ª–∞1.ts] -of [–ò–º—è–§–∞–π–ª–∞2.ts] ...\` (—É—Ç–æ—á–Ω–∏–≤ –æ–∂–∏–¥–∞–µ–º—ã–π –º–æ–¥—É–ª—å/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å \`-d [–ø—É—Ç—å]\`). –Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é **–ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥** —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ \`--- File: [–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É] ---\` –≤ \`\`\`[—è–∑—ã–∫] –±–ª–æ–∫–µ.

---

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –ü—Ä–æ—à–ª–æ–π –°–µ—Å—Å–∏–∏:**

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ **–†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏ (–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –°–Ω–∏–º–æ–∫)**, –∫–æ—Ç–æ—Ä–æ–µ —Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–∞—É–∑–æ–π. –û–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –≥–¥–µ –º—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –µ–≥–æ.

\`\`\`markdown
[!!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ü–û–õ–ù–´–ô –¢–ï–ö–°–¢ "–†–ï–ó–Æ–ú–ï –°–ï–°–°–ò–ò" –° –ü–†–û–®–õ–û–ì–û –†–ê–ó–ê !!!]
\`\`\`

---

**–¢–≤–æ—è –ü–µ—Ä–≤–∞—è –ó–∞–¥–∞—á–∞ –°–µ–π—á–∞—Å (–ó–∞–ø—Ä–æ—Å –ë–∞–∑–æ–≤–æ–≥–æ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞):**

–†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç–µ–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º **–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞**. –¢–≤–æ—è **–ø–µ—Ä–≤–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞** ‚Äî –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –º–µ–Ω—è —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç.

**–ß—Ç–æ —Ç—ã –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –≤ —Å–≤–æ–µ–º –ü–ï–†–í–û–ú –æ—Ç–≤–µ—Ç–µ –º–Ω–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏:**

1.  **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏** –ø–æ–ª—É—á–µ–Ω–∏–µ –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏ –∏ –∫—Ä–∞—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é *–ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é* –∑–∞–¥–∞—á—É –∏–∑ –Ω–µ–≥–æ.
2.  **–û–±—ä—è—Å–Ω–∏**, —á—Ç–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç–µ–±–µ –Ω—É–∂–µ–Ω **–±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** –ø—Ä–æ–µ–∫—Ç–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏).
3.  **–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —á–µ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å** –∫–æ –º–Ω–µ, –ø–æ–ø—Ä–æ—Å–∏–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ** –∫–æ–º–∞–Ω–¥—ã \`dirtree\` –∏ \`codescan\` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Ö –≤—ã–≤–æ–¥. –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º:
    *   –ó–∞–ø—Ä–æ—Å –Ω–∞ **–æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞**: –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–º–∞–Ω–¥—É \`dirtree\`, –Ω–∞–ø—Ä–∏–º–µ—Ä: \`dirtree --md ${DIRTREE_MAX_DEPTH}\`.
    *   –ó–∞–ø—Ä–æ—Å –Ω–∞ **–∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**: –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–º–∞–Ω–¥—É \`codescan\`, —è–≤–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏–≤ **–∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤** (\`-of ...\`), –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Å–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ${ESSENTIAL_FILES.map(f => path.basename(f)).join(', ')} –∏ –¥—Ä—É–≥–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ). –£—Ç–æ—á–Ω–∏, –∏–∑ –∫–∞–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (\`-d\`) –º–Ω–µ –ª—É—á—à–µ –∏—Ö –∑–∞–ø—É—Å–∫–∞—Ç—å, –µ—Å–ª–∏ —ç—Ç–æ –≤–∞–∂–Ω–æ.
4.  **–°–æ–æ–±—â–∏**, —á—Ç–æ —Ç—ã –±—É–¥–µ—à—å –∂–¥–∞—Ç—å –º–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ —Å –≤—ã–≤–æ–¥–æ–º —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ–π –∏–∑ –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏.

**–ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ –∫–æ–¥ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—à—å –∏ –Ω–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —Ç–æ–±–æ–π –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç!**

---

**–ü–†–ï–î–û–°–¢–ê–í–õ–ï–ù–ù–´–ô –ë–ê–ó–û–í–´–ô –ö–û–ù–¢–ï–ö–°–¢ (–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —É—Ç–∏–ª–∏—Ç–æ–π \`aicon\`):**

`;

// --- –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ---
const argv = yargs(hideBin(process.argv))
  .usage("Usage: aicon [options]") // –û–±–Ω–æ–≤–∏–ª–∏ Usage
  .option("output", {
    alias: "o",
    type: "string",
    description: "–ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞",
    default: DEFAULT_OUTPUT_FILENAME,
  })
  .option("resume-file", {
      alias: "r",
      type: "string",
      description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏ (–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –°–Ω–∏–º–∫–æ–º)",
  })
  .help()
  .alias("help", "h")
  .parseSync();

// --- –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ dirtree) ---
const TEE = "‚îú‚îÄ‚îÄ ";
const ELBOW = "‚îî‚îÄ‚îÄ ";
const PIPE = "‚îÇ   ";
const SPACE = "    ";
const excludeDirsSet = new Set(DIRTREE_EXCLUDE_DIRS);

async function generateTree(directory, currentDepth, prefix = "") {
  if (currentDepth > DIRTREE_MAX_DEPTH) return "";

  let treeString = "";
  let entries;
  const outputFilePathAbs = path.resolve(process.cwd(), argv.output); // –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É

  try {
    entries = await fs.readdir(directory, { withFileTypes: true });
  } catch (error) {
    if (error.code !== 'EACCES' && error.code !== 'ENOENT') { // –ù–µ –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø–∞–ø–∫–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç
        console.error(`\n‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ${directory}: ${error.message}`);
    }
    return `${prefix}${ELBOW} [–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞] ${path.basename(directory)}\n`;
  }

  const filteredEntries = entries.filter(
    (entry) =>
      !excludeDirsSet.has(entry.name) &&
      path.join(directory, entry.name) !== outputFilePathAbs // –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
  );

  filteredEntries.sort((a, b) => {
    if (a.isDirectory() && !b.isDirectory()) return -1;
    if (!a.isDirectory() && b.isDirectory()) return 1;
    return a.name.localeCompare(b.name);
  });

  const count = filteredEntries.length;
  for (let i = 0; i < count; i++) {
    const entry = filteredEntries[i];
    const isLast = i === count - 1;
    const connector = isLast ? ELBOW : TEE;
    const entryPath = path.join(directory, entry.name);

    treeString += `${prefix}${connector}${entry.name}\n`;

    if (entry.isDirectory()) {
      const nextPrefix = prefix + (isLast ? SPACE : PIPE);
      treeString += await generateTree(entryPath, currentDepth + 1, nextPrefix);
    }
  }
  return treeString;
}

// --- –õ–æ–≥–∏–∫–∞ —á—Ç–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π codescan) ---
async function scanEssentialFiles(fileList, projectRoot) {
  let allContent = "";
  console.log("\nüîç –ß—Ç–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:");

  for (const relativeFilePath of fileList) {
    const fullPath = path.resolve(projectRoot, relativeFilePath);
    try {
      const fileContent = await fs.readFile(fullPath, "utf8");
      console.log(`   -> –ü—Ä–æ—á–∏—Ç–∞–Ω: ${relativeFilePath}`);
      allContent += `--- File: ${relativeFilePath} ---\n\n`;
      allContent += fileContent.trim();
      allContent += `\n\n--- End of File: ${relativeFilePath} ---\n\n\n`;
    } catch (error) {
      if (error.code === "ENOENT") {
        console.warn(`   ‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (–ø—Ä–æ–ø—É—â–µ–Ω): ${relativeFilePath}`);
      } else {
        console.error(`   ‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ ${relativeFilePath}:`, error.message);
      }
      // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω
      allContent += `--- File: ${relativeFilePath} ---\n\n`;
      allContent += `[!!! –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ${error.message || 'ENOENT'} !!!]`;
      allContent += `\n\n--- End of File: ${relativeFilePath} ---\n\n\n`;
    }
  }
  return allContent;
}

// --- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ---
async function run() {
  const projectRoot = process.cwd();
  const outputFilename = argv.output;
  const outputFilePath = path.resolve(projectRoot, outputFilename);
  const resumeFilePath = argv.resumeFile ? path.resolve(projectRoot, argv.resumeFile) : null;


  console.log(`--- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI —Å–µ—Å—Å–∏–∏ (aicon) ---`); // –û–±–Ω–æ–≤–∏–ª–∏ –ª–æ–≥
  console.log(`–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ${projectRoot}`);
  console.log(`–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: ${outputFilePath}`);
  if(resumeFilePath) {
    console.log(`–§–∞–π–ª –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏: ${resumeFilePath}`);
  } else {
    console.log(`–§–∞–π–ª –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏: –ù–µ —É–∫–∞–∑–∞–Ω (–∑–∞–º–µ–Ω–∏—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –≤—Ä—É—á–Ω—É—é)`);
  }
  console.log("-------------------------------------------------\n");

  // 1. –ß–∏—Ç–∞–µ–º –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏, –µ—Å–ª–∏ —Ñ–∞–π–ª —É–∫–∞–∑–∞–Ω
  let sessionResumeContent = "[!!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ü–û–õ–ù–´–ô –¢–ï–ö–°–¢ \"–†–ï–ó–Æ–ú–ï –°–ï–°–°–ò–ò\" –° –ü–†–û–®–õ–û–ì–û –†–ê–ó–ê –ò–õ–ò –£–î–ê–õ–ò–¢–ï –≠–¢–û–¢ –ë–õ–û–ö !!!]";
  if (resumeFilePath) {
      try {
          sessionResumeContent = await fs.readFile(resumeFilePath, 'utf8');
          console.log(`‚úÖ –†–µ–∑—é–º–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –∏–∑ ${argv.resumeFile}`);
      } catch (error) {
          console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –†–µ–∑—é–º–µ –°–µ—Å—Å–∏–∏ (${argv.resumeFile}): ${error.message}. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.`);
      }
  }
   // –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ (–∏–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä) –≤ —à–∞–±–ª–æ–Ω
   const finalPromptTemplate = NEW_SESSION_PROMPT_TEMPLATE.replace(
    /\[!!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ü–û–õ–ù–´–ô –¢–ï–ö–°–¢ "–†–ï–ó–Æ–ú–ï –°–ï–°–°–ò–ò" –° –ü–†–û–®–õ–û–ì–û –†–ê–ó–ê !!!\]/g, // –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
    sessionResumeContent.trim() // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏–∑ —Ä–µ–∑—é–º–µ
  );


  // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
  console.log("üå≥ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤...");
  const rootDirName = path.basename(projectRoot);
  let treeOutput = `${rootDirName}\n`;
  treeOutput += await generateTree(projectRoot, 0); // –ì–ª—É–±–∏–Ω–∞ 0 –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞
  console.log("   -> –î–µ—Ä–µ–≤–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ.");

  // 3. –°–∫–∞–Ω–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
  const essentialFilesContent = await scanEssentialFiles(ESSENTIAL_FILES, projectRoot);

  // 4. –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
  // –î–æ–±–∞–≤–∏–ª–∏ —è–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const finalOutput = `
${finalPromptTemplate}

<!-- –ù–ê–ß–ê–õ–û –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–û–ì–û –ö–û–ù–¢–ï–ö–°–¢–ê -->

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ \`aicon\`, –≥–ª—É–±–∏–Ω–∞ ${DIRTREE_MAX_DEPTH}):**
\`\`\`text
${treeOutput.trim()}
\`\`\`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ö–ª—é—á–µ–≤—ã—Ö –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –§–∞–π–ª–æ–≤ (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ \`aicon\`):**
\`\`\`typescript 
// –∏–ª–∏ –¥—Ä—É–≥–æ–π —è–∑—ã–∫ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
${essentialFilesContent.trim()}
\`\`\`

<!-- –ö–û–ù–ï–¶ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–û–ì–û –ö–û–ù–¢–ï–ö–°–¢–ê -->
`;

  // 5. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª
  try {
    await fs.writeFile(outputFilePath, finalOutput.trim() + '\n', "utf8");
    console.log(`\n‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ AI —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: ${outputFilename}`);
    console.log("   -> –¢–µ–ø–µ—Ä—å —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ —á–∞—Ç —Å AI.");
  } catch (error) {
    console.error(`\n‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª ${outputFilename}:`, error);
    process.exit(1);
  }
}

// --- –ó–∞–ø—É—Å–∫ ---
run();

--- End of File: aicon.js ---


--- File: comment-remover.js ---

#!/usr/bin/env node

import fs from "fs/promises";
import path from "path";
import yargs from "yargs";
import { hideBin } from "yargs/helpers";
import ignore from "ignore";

// --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ---
const argv = yargs(hideBin(process.argv))
  .usage("Usage: $0 [options]")
  .option("dir", {
    alias: "d",
    type: "string",
    description: "–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤",
    default: ".",
  })
  .option("exclude-dirs", {
    alias: "ed",
    type: "array",
    description: "–ò–º–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è",
    default: [
      "node_modules",
      ".git",
      "dist",
      "build",
      "coverage",
      ".vscode",
      ".idea",
    ],
  })
  .option("exclude-files", {
    alias: "ef",
    type: "array",
    description: "–®–∞–±–ª–æ–Ω—ã —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–≥–ª–æ–±-–ø–∞—Ç—Ç–µ—Ä–Ω—ã)",
    default: ["package-lock.json", "*.log", "*.min.js", "*.min.css", "*.map"],
  })
  .option("extensions", {
    alias: "ext",
    type: "array",
    description: "–†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∑ —Ç–æ—á–∫–∏)",
    // –û—Å–Ω–æ–≤–Ω—ã–µ –≤–µ–± + –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥—Ä—É–≥–∏–µ
    default: [
      "js",
      "jsx",
      "ts",
      "tsx",
      "mjs",
      "cjs",
      "css",
      "scss",
      "less",
      "html",
      "vue",
      "svelte",
      "json",
      "md",
      "yaml",
      "yml",
      "py",
      "java",
      "cs",
      "php",
      "rb",
      "go",
      "swift",
      "kt",
    ],
  })
  .option("dry-run", {
    alias: "dr",
    type: "boolean",
    description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤",
    default: false,
  })
  .option("verbose", {
    alias: "v",
    type: "boolean",
    description: "–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ (—á—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)",
    default: false,
  })
  .help()
  .alias("help", "h")
  // –£–±—Ä–∞–ª alias -v –¥–ª—è version, —Ç.–∫. –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è verbose
  .epilog(
    "–£–¥–∞–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Å—Ç–∞—Ä–∞—è—Å—å –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ regex."
  )
  .parseSync();

// --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ---
const ROOT_DIRECTORY = path.resolve(argv.dir);
const EXCLUDE_DIRS_SET = new Set(argv.excludeDirs);
const EXCLUDE_FILES_PATTERNS = argv.excludeFiles;
const ALLOWED_EXTENSIONS = new Set(
  argv.extensions.map((ext) => `.${ext.toLowerCase()}`)
);
const DRY_RUN = argv.dryRun;
const VERBOSE = argv.verbose;

// --- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è –Ω–µ-JS/TS) ---
const multiLineCommentRegexCSS = /\/\*[\s\S]*?\*\//g; // CSS/SCSS/Less
const htmlCommentRegex = /<!--[\s\S]*?-->/g; // HTML/XML/Vue/Svelte
const hashCommentRegex = /#.*$/gm; // Python, Ruby, Yaml, Shell
const cStyleSingleLineRegex = /\/\/.*$/gm; // Java, C#, Go, Swift, Kotlin, PHP (–∏–Ω–æ–≥–¥–∞)
const cStyleMultiLineRegex = /\/\*[\s\S]*?\*\//g; // Java, C#, Go, Swift, Kotlin, PHP

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ignore` ---
const ig = ignore();
ig.add(argv.excludeDirs.map((dir) => `${dir}/`));
ig.add(EXCLUDE_FILES_PATTERNS);

// –ó–∞–≥—Ä—É–∑–∫–∞ .gitignore
let gitignoreLoaded = false;
try {
  const gitignorePath = path.join(ROOT_DIRECTORY, ".gitignore");
  const gitignoreContent = await fs.readFile(gitignorePath, "utf8");
  ig.add(gitignoreContent);
  gitignoreLoaded = true;
} catch {
  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ .gitignore –Ω–µ—Ç
}

// --- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è JS/TS/JSX/TSX ---
function removeJsTsComments(code) {
  let result = "";
  let inMultiLineComment = false;
  let inSingleLineComment = false;
  let inSingleQuote = false;
  let inDoubleQuote = false;
  let inTemplateLiteral = false;
  let inRegexLiteral = false;
  let isEscaped = false;

  for (let i = 0; i < code.length; i++) {
    const char = code[i];
    const prevChar = i > 0 ? code[i - 1] : null;
    const nextChar = i < code.length - 1 ? code[i + 1] : null;

    if (isEscaped) {
      isEscaped = false;
      // –ï—Å–ª–∏ –º—ã –±—ã–ª–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Å–∏–º–≤–æ–ª –ø–æ—Å–ª–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
      // –ò–Ω–∞—á–µ - –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å
      if (!inMultiLineComment && !inSingleLineComment) {
        result += char;
      }
      continue;
    }

    if (char === "\\") {
      isEscaped = true;
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–∞–º \ –µ—Å–ª–∏ –æ–Ω –Ω–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
      if (!inMultiLineComment && !inSingleLineComment) {
        result += char;
      }
      continue;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ /* ... */
    if (
      !inSingleQuote &&
      !inDoubleQuote &&
      !inTemplateLiteral &&
      !inRegexLiteral
    ) {
      if (char === "/" && nextChar === "*") {
        if (!inMultiLineComment) {
          // –ù–∞—á–∞–ª–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          inMultiLineComment = true;
          i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º *
          continue;
        }
      } else if (char === "*" && nextChar === "/") {
        if (inMultiLineComment) {
          // –ö–æ–Ω–µ—Ü –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          inMultiLineComment = false;
          i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º /
          continue;
        }
      }
    }

    // –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–º–≤–æ–ª
    if (inMultiLineComment) {
      continue;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ // ...
    if (
      !inSingleQuote &&
      !inDoubleQuote &&
      !inTemplateLiteral &&
      !inRegexLiteral
    ) {
      if (char === "/" && nextChar === "/") {
        if (!inSingleLineComment) {
          // –ù–∞—á–∞–ª–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          inSingleLineComment = true;
          i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—Ç–æ—Ä–æ–π /
          continue;
        }
      } else if (char === "\n") {
        if (inSingleLineComment) {
          // –ö–æ–Ω–µ—Ü –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          inSingleLineComment = false;
          // –î–æ–±–∞–≤–ª—è–µ–º —Å–∞–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–µ —á–∞—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          result += char;
          continue;
        }
      }
    }

    // –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–∏ —ç—Ç–æ –Ω–µ \n), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–º–≤–æ–ª
    if (inSingleLineComment) {
      continue;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
    if (!inRegexLiteral) {
      if (char === "'" && !inDoubleQuote && !inTemplateLiteral) {
        inSingleQuote = !inSingleQuote;
      } else if (char === '"' && !inSingleQuote && !inTemplateLiteral) {
        inDoubleQuote = !inDoubleQuote;
      } else if (char === "`" && !inSingleQuote && !inDoubleQuote) {
        inTemplateLiteral = !inTemplateLiteral;
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è, –Ω–æ –ª—É—á—à–µ —á–µ–º –Ω–∏—á–µ–≥–æ)
    // –°—Ç–∞—Ä–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ / –Ω–∞—á–∞–ª–æ–º regex –∏–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –¥–µ–ª–µ–Ω–∏—è
    if (
      !inSingleQuote &&
      !inDoubleQuote &&
      !inTemplateLiteral &&
      !inMultiLineComment &&
      !inSingleLineComment
    ) {
      if (char === "/") {
        // –û—á–µ–Ω—å –≥—Ä—É–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ / –∏–¥–µ—Ç –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, —Å—á–∏—Ç–∞–µ–º regex
        // –ù–µ –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ –æ—Ç—Å–µ–∫–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤ –¥–µ–ª–µ–Ω–∏—è
        const prevNonWs = (() => {
          for (let j = i - 1; j >= 0; j--) {
            if (!/\s/.test(code[j])) return code[j];
          }
          return null;
        })();

        if (
          !inRegexLiteral &&
          [
            "(",
            ",",
            "=",
            ":",
            "[",
            "!",
            "&",
            "|",
            "?",
            "{",
            "}",
            ";",
            "\n",
            null,
          ].includes(prevNonWs)
        ) {
          inRegexLiteral = true;
        } else if (inRegexLiteral) {
          // –ö–æ–Ω–µ—Ü regex, –µ—Å–ª–∏ / –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ –Ω–∞—á–∞–ª–æ –∫–ª–∞—Å—Å–æ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ [...]
          if (prevChar !== "\\" && prevChar !== "[") {
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–ª–∞—Å—Å—ã
            inRegexLiteral = false;
          }
        }
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    result += char;
  }

  return result;
}

// --- –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ---
async function removeCommentsFromFile(filePath) {
  const extension = path.extname(filePath).toLowerCase();
  if (!ALLOWED_EXTENSIONS.has(extension)) {
    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Ü–µ–ª–µ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
  }

  try {
    const originalContent = await fs.readFile(filePath, "utf8");
    let newContent = originalContent;

    const jsTsExtensions = [".js", ".jsx", ".ts", ".tsx", ".mjs", ".cjs"];
    const cssLikeExtensions = [".css", ".scss", ".less"];
    const htmlLikeExtensions = [".html", ".vue", ".svelte", ".xml", ".svg"];
    const hashCommentLangs = [".py", ".rb", ".yml", ".yaml"]; // .sh, .pl etc.
    const cStyleLangs = [".java", ".cs", ".go", ".swift", ".kt", ".php"]; // PHP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏ #, –∏ //, –∏ /* */

    if (jsTsExtensions.includes(extension)) {
      newContent = removeJsTsComments(originalContent);
    } else if (cssLikeExtensions.includes(extension)) {
      newContent = newContent.replace(multiLineCommentRegexCSS, "");
    } else if (htmlLikeExtensions.includes(extension)) {
      newContent = newContent.replace(htmlCommentRegex, "");
      // TODO: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å removeJsTsComments/removeCssComments –¥–ª—è <script>/<style>
    } else if (hashCommentLangs.includes(extension)) {
      newContent = newContent.replace(hashCommentRegex, "");
    } else if (cStyleLangs.includes(extension)) {
      newContent = newContent.replace(cStyleSingleLineRegex, "");
      newContent = newContent.replace(cStyleMultiLineRegex, "");
      if (extension === ".php") {
        // PHP –º–æ–∂–µ—Ç –∏–º–µ—Ç—å #
        newContent = newContent.replace(hashCommentRegex, "");
      }
    } else if (extension === ".json") {
      // JSON —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
    } else if (extension === ".md") {
      // Markdown –º–æ–∂–µ—Ç –∏–º–µ—Ç—å HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
      newContent = newContent.replace(htmlCommentRegex, "");
    }

    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç—å—Å—è
    // –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏, —Å–æ—Å—Ç–æ—è—â–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–±–µ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    newContent = newContent.replace(/^[ \t]*[\r\n]/gm, "");
    // –£–¥–∞–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è –æ–¥–Ω—É
    newContent = newContent.replace(/(\r?\n){2,}/g, "\n\n");

    if (newContent !== originalContent) {
      const relativePath = path.relative(ROOT_DIRECTORY, filePath);
      if (DRY_RUN) {
        console.log(
          `[DRY RUN] üßπ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑: ${relativePath}`
        );
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥ diff –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏, –Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç –∫–æ–¥
      } else {
        try {
          await fs.writeFile(filePath, newContent.trim() + "\n", "utf8"); // trim + \n –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã
          console.log(`üßπ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑: ${relativePath}`);
        } catch (writeError) {
          console.error(
            `‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ ${relativePath}: ${writeError.message}`
          );
        }
      }
    }
  } catch (error) {
    const relativePath = path.relative(ROOT_DIRECTORY, filePath);
    if (error.code === "EACCES") {
      console.warn(`‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É: ${relativePath}`);
    } else if (error.code === "EISDIR") {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    } else if (error.code === "ENOENT") {
      console.warn(
        `‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, —É–¥–∞–ª–µ–Ω –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã): ${relativePath}`
      );
    } else {
      console.error(
        `‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ${relativePath}: ${error.message}`
      );
    }
  }
}

// --- –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ö–æ–¥–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π ---
async function processDirectory(directory) {
  let entries;
  try {
    entries = await fs.readdir(directory, { withFileTypes: true });
  } catch (error) {
    const relativePath = path.relative(ROOT_DIRECTORY, directory);
    if (error.code === "EACCES") {
      console.warn(`‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: ${relativePath}`);
    } else {
      console.error(
        `‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ${relativePath}: ${error.message}`
      );
    }
    return;
  }

  for (const entry of entries) {
    const currentPath = path.join(directory, entry.name);
    const relativePath = path.relative(ROOT_DIRECTORY, currentPath);

    if (ig.ignores(relativePath)) {
      if (VERBOSE) console.log(`-- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–∞–≤–∏–ª–æ): ${relativePath}`);
      continue;
    }

    if (entry.isDirectory()) {
      // –î–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ .gitignore –∏—Ö —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)
      if (EXCLUDE_DIRS_SET.has(entry.name)) {
        if (VERBOSE)
          console.log(`-- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ): ${relativePath}/`);
        continue;
      }
      await processDirectory(currentPath);
    } else if (entry.isFile()) {
      await removeCommentsFromFile(currentPath);
    }
  }
}

// --- –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ ---
async function run() {
  console.log("--- –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (v1.2) ---");
  console.log(`–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${ROOT_DIRECTORY}`);
  console.log(
    `–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: ${[...ALLOWED_EXTENSIONS].join(", ")}`
  );
  console.log(`–ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: ${argv.excludeDirs.join(", ")}`);
  console.log(
    `–ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø–∞—Ç—Ç–µ—Ä–Ω—ã: ${EXCLUDE_FILES_PATTERNS.join(", ")}`
  );
  if (gitignoreLoaded) console.log("‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ .gitignore");
  if (DRY_RUN) {
    console.log("\n‚ö†Ô∏è –†–ï–ñ–ò–ú –°–£–•–û–ì–û –ó–ê–ü–£–°–ö–ê (–§–ê–ô–õ–´ –ù–ï –ë–£–î–£–¢ –ò–ó–ú–ï–ù–ï–ù–´) ‚ö†Ô∏è");
  }
  console.log("------------------------------------");

  try {
    console.log("\nüîç –ü–æ–∏—Å–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤...");
    await processDirectory(ROOT_DIRECTORY);
    console.log("\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
    if (DRY_RUN) {
      console.log("‚ÑπÔ∏è –§–∞–π–ª—ã –Ω–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã (--dry-run).");
    }
  } catch (error) {
    console.error("\n‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:", error);
    process.exit(1);
  }
}

// --- –ó–∞–ø—É—Å–∫ ---
run();

--- End of File: comment-remover.js ---


--- File: dirtree.js ---

#!/usr/bin/env node

import fs from "fs/promises";
import path from "path";
import yargs from "yargs";
import { hideBin } from "yargs/helpers";

// --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ---
const argv = yargs(hideBin(process.argv))
  .usage("Usage: $0 [options]")
  .option("output", {
    alias: "o",
    type: "string",
    description: "–ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤",
    default: "directory_tree.txt",
  })
  .option("dir", {
    alias: "d",
    type: "string",
    description: "–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞",
    default: ".", // –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  })
  .option("exclude-dirs", {
    alias: "ed",
    type: "array",
    description:
      "–ò–º–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)",
    default: ["node_modules", ".git"], // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
  })
  .option("max-depth", {
    alias: "md",
    type: "number",
    description: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (0 - —Ç–æ–ª—å–∫–æ –∫–æ—Ä–µ–Ω—å)",
    // default: Infinity // –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  })
  .help()
  .alias("help", "h")
  .alias("version", "v")
  .epilog("–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤.")
  .parseSync();

// --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ---
const ROOT_DIRECTORY = path.resolve(argv.dir);
const OUTPUT_FILENAME = argv.output;
const OUTPUT_FILEPATH = path.resolve(process.cwd(), OUTPUT_FILENAME);
const EXCLUDE_DIRS_SET = new Set(argv.excludeDirs); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Set –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
const MAX_DEPTH = argv.maxDepth ?? Infinity; // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –≥–ª—É–±–∏–Ω–∞ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞

// –°–∏–º–≤–æ–ª—ã –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –¥–µ—Ä–µ–≤–∞
const TEE = "‚îú‚îÄ‚îÄ ";
const ELBOW = "‚îî‚îÄ‚îÄ ";
const PIPE = "‚îÇ   ";
const SPACE = "    ";

// --- –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ ---
async function generateTree(directory, currentDepth, prefix = "") {
  if (currentDepth > MAX_DEPTH) {
    return ""; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏—é, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã
  }

  let treeString = "";
  let entries;

  try {
    // –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ–ª—É—á–∞—è —Ç–∏–ø—ã (—Ñ–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)
    entries = await fs.readdir(directory, { withFileTypes: true });
  } catch (error) {
    if (error.code === "EACCES") {
      return `${prefix}${ELBOW} [–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞] ${path.basename(directory)}\n`;
    } else {
      console.error(
        `\n‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ${directory}: ${error.message}`
      );
      return `${prefix}${ELBOW} [–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è] ${path.basename(directory)}\n`;
    }
  }

  // –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Å–∞–º –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª (–µ—Å–ª–∏ –æ–Ω –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ)
  const filteredEntries = entries.filter(
    (entry) =>
      !EXCLUDE_DIRS_SET.has(entry.name) &&
      path.join(directory, entry.name) !== OUTPUT_FILEPATH // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–º –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
  );

  // –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ—Ç–æ–º —Ñ–∞–π–ª—ã (–∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø)
  filteredEntries.sort((a, b) => {
    if (a.isDirectory() && !b.isDirectory()) return -1;
    if (!a.isDirectory() && b.isDirectory()) return 1;
    return a.name.localeCompare(b.name);
  });

  const count = filteredEntries.length;
  for (let i = 0; i < count; i++) {
    const entry = filteredEntries[i];
    const isLast = i === count - 1; // –ü–æ—Å–ª–µ–¥–Ω–∏–π –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ?

    const connector = isLast ? ELBOW : TEE;
    const entryPath = path.join(directory, entry.name);

    treeString += `${prefix}${connector}${entry.name}\n`;

    if (entry.isDirectory()) {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
      const nextPrefix = prefix + (isLast ? SPACE : PIPE);
      // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º –¥–ª—è –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
      treeString += await generateTree(entryPath, currentDepth + 1, nextPrefix);
    }
  }

  return treeString;
}

// --- –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ ---
async function run() {
  console.log("--- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ ---");
  console.log(`–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${ROOT_DIRECTORY}`);
  console.log(`–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: ${OUTPUT_FILEPATH}`);
  console.log(
    `–ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: ${argv.excludeDirs.join(", ") || "–ù–µ—Ç"}`
  );
  if (MAX_DEPTH !== Infinity) {
    console.log(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞: ${MAX_DEPTH}`);
  }
  console.log("---------------------------------\n");

  try {
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –Ω–∞—á–∞–ª–æ –≤—ã–≤–æ–¥–∞
    const rootDirName = path.basename(ROOT_DIRECTORY) || ROOT_DIRECTORY; // –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —É–∫–∞–∑–∞–ª–∏ '/' –∏–ª–∏ '.'
    let finalTree = `${rootDirName}\n`;

    console.log("üå≥ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞...");
    finalTree += await generateTree(ROOT_DIRECTORY, 0); // –ù–∞—á–∏–Ω–∞–µ–º —Å –≥–ª—É–±–∏–Ω—ã 0

    console.log(`\nüíæ –ó–∞–ø–∏—Å—å –¥–µ—Ä–µ–≤–∞ –≤ —Ñ–∞–π–ª: ${OUTPUT_FILEPATH}`);
    await fs.writeFile(OUTPUT_FILEPATH, finalTree.trim() + "\n", "utf8");

    console.log(
      `\n‚úÖ –£—Å–ø–µ—à–Ω–æ! –î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ ${OUTPUT_FILENAME}`
    );
  } catch (error) {
    console.error("\n‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞:", error);
    process.exit(1);
  }
}

// --- –ó–∞–ø—É—Å–∫ ---
run();

--- End of File: dirtree.js ---


--- File: package.json ---

{
  "name": "admin228-cli-utils",
  "version": "1.3.0",
  "description": "–ù–∞–±–æ—Ä CLI-—É—Ç–∏–ª–∏—Ç: codescan, dirtree, comrem –∏ aicon (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI).",
  "main": "codescan.js",
  "type": "module",
  "bin": {
    "codescan": "./codescan.js",
    "dirtree": "./dirtree.js",
    "comrem": "./comment-remover.js",
    "aicon": "./aicon.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "cli",
    "util",
    "node",
    "code",
    "scan",
    "concatenate",
    "directory",
    "tree",
    "structure",
    "comment",
    "remove",
    "clean",
    "ai",
    "context",
    "prompt",
    "session",
    "prepare"
  ],
  "author": "admin228",
  "license": "ISC",
  "dependencies": {
    "ignore": "^5.3.1",
    "yargs": "^17.7.2"
  },
  "devDependencies": {}
}

--- End of File: package.json ---


--- File: test/index.js ---

let a = 5;

--- End of File: test/index.js ---
